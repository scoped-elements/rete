{"version":3,"file":"stage0-render-plugin.debug.js","sources":["../src/components.js","../src/index.js"],"sourcesContent":["import h from \"stage0\";\nimport { keyed } from \"stage0/keyed\";\n\nimport \"./node.sass\";\nimport \"./socket.sass\";\n\n/**\n * Base component\n * @param {*} scope\n */\nexport function BaseComponent(scope) {\n  const view = this.getView();\n\n  this.root = view.cloneNode(true);\n\n  const refCl = view.collect(this.root);\n\n  this.setRefs(refCl);\n  this.init(scope);\n}\n\nBaseComponent.prototype = {\n  getView: function() {\n    return h([\"<div></div>\"]);\n  },\n  init: function(scope) {\n    this.root.update = this.rootUpdate.bind(this);\n    this.root.update(scope);\n  },\n  setRefs: function(refCl) {\n    this.refs = refCl;\n  },\n  rootUpdate: function(_scope) {}\n};\n\nexport function extend(ChildClass, ParentClass) {\n  ChildClass.prototype = Object.assign({}, ParentClass.prototype, ChildClass.prototype);\n  ChildClass.prototype.constructor = ChildClass;\n}\n\n/**\n * Socket component\n * @param {*} socket\n * @param {*} type\n */\nexport function SocketComponent(io, type, node) {\n  this.type = type;\n  this.node = node;\n  this.name;\n  this.hint;\n  BaseComponent.call(this, io);\n}\n\nSocketComponent.prototype.init = function(io) {\n  BaseComponent.prototype.init.call(this, io.socket);\n  this.node.context.bindSocket(this.root, this.type, io);\n};\n\nSocketComponent.prototype.getView = function() {\n  return h([\"<div></div>\"]);\n};\n\nSocketComponent.prototype.rootUpdate = function(socket) {\n  if (this.name !== socket.name) this.root.className = \"socket \" + socket.name + \" \" + this.type;\n\n  if (this.name !== socket.name || this.hint !== socket.hint)\n    this.root.title = socket.name + \"\\\\n\" + (socket.hint ? socket.hint : \"\");\n\n  this.name = socket.name;\n  this.hint = socket.hint;\n};\n\nextend(SocketComponent, BaseComponent);\n\n/**\n * Control component\n * @param {*} control\n */\nexport function ControlComponent(control) {\n  this.control = control;\n  BaseComponent.call(this, control);\n}\n\nControlComponent.prototype.init = function(control) {\n  let ctx;\n  if (this.control.parent.context) ctx = this.control.parent.context;\n  else if (this.control.parent.node) ctx = this.control.parent.node.context;\n  ctx.bindControl(this.root, control);\n  BaseComponent.prototype.init.call(this, control);\n\n  this.root.addEventListener(\"mousedown\", e => {\n    e.stopPropagation();\n  });\n};\n\nControlComponent.prototype.getView = function() {\n  return h(['<div class=\"control\"></div>']);\n};\n\nControlComponent.prototype.rootUpdate = function(control) {\n  if (this.control.key !== control.key) {\n    while (this.root.firstChild) {\n      this.root.removeChild(this.root.firstChild);\n    }\n    this.root.appendChild(control.stage0Context.root);\n  }\n  this.control = control;\n};\n\nextend(ControlComponent, BaseComponent);\n\n/**\n * Input component\n * @param {*} input\n */\nexport function InputComponent(input, node) {\n  this.name = null;\n  this.node = node;\n  this.showControl = null;\n  BaseComponent.call(this, input);\n}\n\nInputComponent.prototype.getView = function() {\n  return h([\n    '<div class=\"input\"><span class=\"input-socket\" #socket></span><div class=\"input-title\" #inputTitle>#inputName</div><div class=\"input-control\" #controls></div></div>'\n  ]);\n};\n\nInputComponent.prototype.getSocketComponent = function(input) {\n  return new SocketComponent(input, \"input\", this.node);\n};\n\nInputComponent.prototype.getControlComponent = function(input) {\n  return new ControlComponent(input.control, input.node);\n};\n\nInputComponent.prototype.rootUpdate = function(input) {\n  const name = input.name;\n  const showControl = input.showControl();\n\n  if (this.showControl !== showControl) {\n    while (this.refs.controls.firstChild) {\n      this.refs.controls.removeChild(this.refs.controls.firstChild);\n    }\n    if (this.root.contains(this.refs.inputtitle)) {\n      this.root.removeChild(this.refs.inputtitle);\n    }\n    if (showControl) {\n      const controlComp = this.getControlComponent(input);\n      this.refs.controls.appendChild(controlComp.root);\n    } else {\n      this.root.appendChild(this.refs.inputtitle);\n      if (this.name !== name) {\n        this.name = this.refs.inputName.nodeValue = name;\n      }\n    }\n  }\n\n  if (!this.refs.socket.firstChild) {\n    const compSocket = this.getSocketComponent(input);\n    this.refs.socket.appendChild(compSocket.root);\n  }\n};\n\nextend(InputComponent, BaseComponent);\n\n/**\n * Output component\n * @param {*} output\n */\nexport function OutputComponent(output, node) {\n  this.name = null;\n  this.node = node;\n  BaseComponent.call(this, output);\n}\n\nOutputComponent.prototype.getView = function() {\n  return h([\n    '<div class=\"output\"><div class=\"output-title\" #outputTitle>#outputName</div><div #socket></div></div>'\n  ]);\n};\n\nOutputComponent.prototype.getSocketComponent = function(output) {\n  return new SocketComponent(output, \"output\", this.node);\n};\n\nOutputComponent.prototype.rootUpdate = function(output) {\n  let name = output.name;\n\n  if (this.name !== name) {\n    this.name = this.refs.outputName.nodeValue = name;\n  }\n\n  if (!this.refs.socket.firstChild) {\n    const compSocket = this.getSocketComponent(output);\n    this.refs.socket.appendChild(compSocket.root);\n  }\n};\n\nextend(OutputComponent, BaseComponent);\n\n/**\n * Node component\n * @param {*} item\n * @param {*} scope\n */\nexport function NodeComponent(scope) {\n  this.renderedInputs = [];\n  this.renderedOutputs = [];\n  this.renderedControls = [];\n\n  this.visibleInputs = undefined;\n  this.visibleOutputs = undefined;\n  this.visibleControls = undefined;\n\n  this.name = null;\n  this.selected = null;\n\n  this.visibleCollapsed = scope.node.data[\"collapsed\"] ? true : false;\n  this.renderedCollapsed = null;  \n\n  BaseComponent.call(this, scope);\n}\n\nNodeComponent.prototype.init = function(scope) {\n  BaseComponent.prototype.init.call(this, scope);\n\n  this.refs.collapse.addEventListener(\"mousedown\", e => {\n    e.stopPropagation();\n  });\n\n  this.refs.collapse.addEventListener(\"click\", _e => {\n    if (this.refs.collapse.classList.contains(\"closed\")) {\n      this.visibleCollapsed = false;\n    } else {\n      this.visibleCollapsed = true;\n    }\n\n    if(this.visibleCollapsed !== this.renderedCollapsed){\n      this.rootUpdate(scope);\n      scope.editor.view.updateConnections({ node: scope.node });\n    }\n  });\n\n  this.refs.collapse.ondblclick = function(e) {\n    e.stopPropagation();\n  };\n};\n\nNodeComponent.prototype.getView = function() {\n  return h([\n    '<div class=\"node\"><div class=\"collapse\" #collapse></div><div class=\"title\">#nodeName</div><div class=\"outputs\" #outputs></div><div class=\"controls\" #controls></div><div class=\"inputs\" #inputs></div></div>'\n  ]);\n};\n\nNodeComponent.prototype.getInputComponent = function(item, node) {\n  return new InputComponent(item, node);\n};\n\nNodeComponent.prototype.getOutputComponent = function(item, node) {\n  return new OutputComponent(item, node);\n};\n\nNodeComponent.prototype.getControlComponent = function(item, node) {\n  return new ControlComponent(item, node);\n};\n\nNodeComponent.prototype.rootUpdate = function(scope) {\n  const selected = scope.editor.selected.contains(scope.node);\n\n  if (this.name !== scope.node.name || this.selected !== selected) {\n    this.root.classList.remove(this.name);\n    this.root.classList.remove(\"selected\");\n\n    this.root.classList.add(scope.node.name);\n    if(selected)\n      this.root.classList.add(\"selected\");\n  }\n\n  this.selected = selected;\n\n  if (this.name !== scope.node.name) {\n    this.name = this.refs.nodeName.nodeValue = scope.node.name;\n  }\n\n  if(this.visibleCollapsed !== this.renderedCollapsed){\n    if (this.visibleCollapsed) {\n      this.refs.collapse.classList.add(\"closed\");\n      this.root.classList.add(\"collapsed\");\n      this.root.insertBefore(this.refs.inputs, this.refs.collapse);\n    } else {\n      this.refs.collapse.classList.remove(\"closed\");\n      this.root.classList.remove(\"collapsed\");\n      this.root.appendChild(this.refs.inputs);\n    }\n    this.renderedCollapsed = this.visibleCollapsed;\n  }\n\n  this.visibleInputs = Array.from(scope.node.inputs.values()).slice();\n\n  keyed(\n    \"key\",\n    this.refs.inputs,\n    this.renderedInputs,\n    this.visibleInputs,\n    item => this.getInputComponent(item, scope.node).root,\n    (input, item) => {\n      input.update(item);\n    }\n  );\n\n  this.renderedInputs = this.visibleInputs.slice();\n\n  this.visibleOutputs = Array.from(scope.node.outputs.values()).slice();\n\n  keyed(\n    \"key\",\n    this.refs.outputs,\n    this.renderedOutputs,\n    this.visibleOutputs,\n    item => {\n      return this.getOutputComponent(item, scope.node).root;\n    },\n    (output, item) => {\n      output.update(item);\n    }\n  );\n\n  this.renderedOutputs = this.visibleOutputs.slice();\n\n  this.visibleControls = Array.from(scope.node.controls.values()).slice();\n\n  keyed(\n    \"key\",\n    this.refs.controls,\n    this.renderedControls,\n    this.visibleControls,\n    item => this.getControlComponent(item, scope.node).root,\n    (control, item) => {\n      control.update(item);\n    }\n  );\n\n  this.renderedControls = this.visibleControls.slice();\n};\n\nextend(NodeComponent, BaseComponent);\n","import h from \"stage0\";\n\nimport {\n  NodeComponent,\n  SocketComponent,\n  InputComponent,\n  OutputComponent,\n  ControlComponent,\n  extend,\n  BaseComponent\n} from \"./components\";\n\n/**\n * Control component\n * @param {*} control\n */\nfunction RootControlComponent(editor, { el, control, controlProps }) {\n  this.component = Object.assign({}, control.component, controlProps);\n\n  this.editor = editor;\n  this.el = el;\n\n  BaseComponent.call(this, control);\n  this.component.root = this.root;\n}\n\nRootControlComponent.prototype.getView = function() {\n  return h([this.component.template]);\n};\n\nRootControlComponent.prototype.init = function(_control) {\n  this.root.update = this.rootUpdate.bind(this);\n};\n\nRootControlComponent.prototype.rootUpdate = function(_control) {\n  this.component.methods.update.apply(this.component);\n};\n\nextend(RootControlComponent, BaseComponent);\n\nfunction createNode({ el, nodeProps, component }) {\n  const comp = component.component || new NodeComponent(nodeProps);\n  nodeProps.node.stage0Context = comp;\n  el.appendChild(comp.root);\n  return comp;\n}\n\nfunction createControl(editor, { el, control, controlProps }) {\n  const comp = new RootControlComponent(editor, { el, control, controlProps });\n\n  control.stage0Context = comp;\n\n  el.appendChild(comp.root);\n\n  comp.component.mounted();\n\n  return comp;\n}\n\nfunction install(editor, _params) {\n  editor.on(\"rendernode\", ({ el, node, component, bindSocket, bindControl }) => {\n    if (component.render && component.render !== \"stage0\") return;\n    const nodeProps = { ...component.props, node, editor, bindSocket, bindControl };\n    node.context = nodeProps;\n    node._stage0 = createNode({ el, nodeProps, component });\n    node.update = () => {\n      node.stage0Context.rootUpdate(nodeProps);\n    };\n  });\n\n  editor.on(\"rendercontrol\", ({ el, control }) => {\n    if (control.render && control.render !== \"stage0\") return;\n    let controlProps = {\n      ...control.props,\n      getData: control.getData.bind(control),\n      putData: control.putData.bind(control)\n    };\n    control._stage0 = createControl(editor, { el, control, controlProps });\n    control.update = () => {\n      control.stage0Context.rootUpdate(controlProps);\n    };\n  });\n\n  editor.on(\"connectioncreated connectionremoved\", connection => {\n    let inputContext = connection.input.node.context;\n    let outputContext = connection.output.node.context;\n    connection.output.node.stage0Context.rootUpdate(outputContext);\n    connection.input.node.stage0Context.rootUpdate(inputContext);\n  });\n\n  editor.on(\"nodeselected\", () => {\n    for (const key in editor.nodes) {\n      const editorNode = editor.nodes[key];\n      const context = editorNode.context;\n      editorNode.stage0Context.rootUpdate(context);\n    }\n  });\n}\n\nexport default {\n  name: \"stage0-render\",\n  install,\n  NodeComponent,\n  InputComponent,\n  OutputComponent,\n  ControlComponent,\n  RootControlComponent,\n  SocketComponent\n};\n"],"names":["BaseComponent","scope","view","getView","root","cloneNode","refCl","collect","setRefs","init","prototype","h","update","rootUpdate","bind","refs","_scope","extend","ChildClass","ParentClass","Object","assign","constructor","SocketComponent","io","type","node","name","hint","call","socket","context","bindSocket","className","title","ControlComponent","control","ctx","parent","bindControl","addEventListener","e","stopPropagation","key","firstChild","removeChild","appendChild","stage0Context","InputComponent","input","showControl","getSocketComponent","getControlComponent","controls","contains","inputtitle","controlComp","inputName","nodeValue","compSocket","OutputComponent","output","outputName","NodeComponent","renderedInputs","renderedOutputs","renderedControls","visibleInputs","undefined","visibleOutputs","visibleControls","selected","visibleCollapsed","data","renderedCollapsed","collapse","_e","classList","editor","updateConnections","ondblclick","getInputComponent","item","getOutputComponent","remove","add","nodeName","insertBefore","inputs","Array","from","values","slice","keyed","outputs","RootControlComponent","el","controlProps","component","template","_control","methods","apply","createNode","nodeProps","comp","createControl","mounted","install","_params","on","render","props","_stage0","getData","putData","connection","inputContext","outputContext","nodes","editorNode"],"mappings":"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"}